import React, { useState, useEffect } from 'react';
import { 
  Trophy, 
  Star, 
  Lightbulb, 
  ArrowRight, 
  RefreshCcw, 
  CheckCircle, 
  AlertCircle, 
  Heart,
  BookOpen,
  ChevronLeft,
  Home,
  Book,
  Gamepad2
} from 'lucide-react';

const App = () => {
  // çŠ¶æ€ç®¡ç†
  const [view, setView] = useState('home');
  const [selectedUnit, setSelectedUnit] = useState(null);
  const [currentQuestionIdx, setCurrentQuestionIdx] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [selectedOption, setSelectedOption] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);
  const [showHint, setShowHint] = useState(false);

  // å•å…ƒé…ç½®
  const units = [
    { id: "u3", title: "ç¬¬ä¸ƒè¯¾", subtitle: "å¼€å¿ƒåŠ¨ç‰©å›­", icon: "ğŸ¦", color: "bg-orange-400" },
    { id: "u4", title: "å•å…ƒå››", subtitle: "æ¸©é¦¨çš„å®¶", icon: "ğŸ ", color: "bg-blue-400" },
    { id: "u5", title: "å•å…ƒäº”", subtitle: "ä¸­ç§‹èŠ‚", icon: "ğŸ¥®", color: "bg-yellow-400" },
    { id: "u6", title: "å•å…ƒå…­", subtitle: "èƒ†å°çš„çˆ¸çˆ¸", icon: "ğŸ‘¨â€ğŸ‘§", color: "bg-green-400" },
    { id: "u7", title: "å•å…ƒä¸ƒ", subtitle: "ç¾ä¸½çš„åœ£è¯å¡", icon: "ğŸ„", color: "bg-red-400" }
  ];

  // æ›´æ–°åçš„é¢˜åº“æ•°æ® (å·²åˆ é™¤æŒ‡å®šé¢˜ç›®)
  const allQuizData = [
    // --- ç¬¬ä¸ƒè¯¾ (15é¢˜) ---
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "è‰åœ°ä¸Šæœ‰ä¸€ï¼ˆ  ï¼‰å°ç¾Šã€‚", options: ["å¤´", "åª", "æŠŠ", "ä¸ª"], a: 1, hint: "å°åŠ¨ç‰©å¸¸ç”¨é‡è¯ã€‚", r: "ä¸€åªå°ç¾Šã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "å°é¸Ÿåœ¨æ ‘ä¸Šï¼ˆ  ï¼‰ã€‚", options: ["è·³èˆ", "å†™å­—", "å”±æ­Œ", "å¼€é—¨"], a: 2, hint: "å½¢å®¹æ‚¦è€³çš„å£°éŸ³ã€‚", r: "å°é¸Ÿå”±æ­Œã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "å°ç¾Šåœ¨åœ°ä¸Šï¼ˆ  ï¼‰ã€‚", options: ["å”±æ­Œ", "è·³èˆ", "ç”»ç”»", "çœ‹ä¹¦"], a: 1, hint: "è¯¾æ–‡ä¸­çš„åŠ¨ä½œã€‚", r: "å°ç¾Šè·³èˆã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "é©¬ã€ç‰›å’Œç¾Šéƒ½æ˜¯ï¼ˆ  ï¼‰ã€‚", options: ["æœ‹å‹", "å®¶äºº", "åŠ¨ç‰©", "èŠ±ç¯"], a: 2, r: "å®ƒä»¬æ˜¯åŠ¨ç‰©ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "é€‰å‡ºâ€œé©¬â€çš„è¯»éŸ³ï¼š", options: ["mÄ", "mÃ¡", "mÇ", "mÃ "], a: 2, r: "é©¬æ˜¯ä¸‰å£° mÇã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "åŠ¨ç‰©å›­é‡ŒçœŸï¼ˆ  ï¼‰ã€‚", options: ["èƒ†å°", "å¼€å¿ƒ", "ç”Ÿç—…", "ä¸‹ç­"], a: 1, r: "å½¢å®¹æ„‰å¿«çš„å¿ƒæƒ…ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "ä¸€ï¼ˆ  ï¼‰å¤§ç‰›åœ¨èµ°ã€‚ ", options: ["å¤´", "åª", "æ¡", "å¼ "], a: 0, r: "ä½“å‹å¤§çš„åŠ¨ç‰©ç”¨â€œå¤´â€ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "å°ç¾Šé•¿å¾—ï¼ˆ  ï¼‰å¯çˆ±ã€‚", options: ["å¾ˆ", "æŠŠ", "åƒ", "å’Œ"], a: 0, r: "ç¨‹åº¦å‰¯è¯ç”¨â€œå¾ˆâ€ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "å°é¸Ÿä¼šé£ï¼Œå°ç¾Šä¼šï¼ˆ  ï¼‰ã€‚", options: ["é£", "è·‘", "è¯»", "å†™"], a: 1, r: "å°ç¾Šåœ¨åœ°ä¸Šè·‘ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "é€‰å‡ºâ€œå¼€å¿ƒâ€çš„æ­£ç¡®æ‹¼éŸ³ï¼š", options: ["kÄi xÄ«n", "kÄi xÄ«ng", "kÇi xÄ«n", "kÃ i xÄ«n"], a: 0, r: "ç¬¬ä¸€å£° kÄiï¼Œç¬¬ä¸€å£° xÄ«nã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "è‰åœ°ä¸Šï¼ˆ  ï¼‰å¾ˆå¤šåŠ¨ç‰©ã€‚", options: ["æ˜¯", "åœ¨", "æœ‰", "å»"], a: 2, r: "è¡¨ç¤ºå­˜åœ¨çš„â€œæœ‰â€ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "å¤§é©¬åœ¨å‰é¢ï¼Œå°é©¬åœ¨ï¼ˆ  ï¼‰ã€‚", options: ["å‰", "å", "ä¸Š", "ä¸‹"], a: 1, r: "åä¹‰è¯å¯¹æ¯”ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "é€‰å‡ºâ€œç¾Šâ€çš„å­—å½¢ï¼š", options: ["åŠ", "å¹³", "ç¾Š", "ç¾"], a: 2, r: "è¾¨åˆ«å­—å½¢ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "å°åŠ¨ç‰©ï¼ˆ  ï¼‰çˆ±åƒè‰ã€‚", options: ["éƒ½", "å’Œ", "åƒ", "æŠŠ"], a: 0, r: "è¡¨ç¤ºå…¨éƒ¨ç”¨â€œéƒ½â€ã€‚" },
    { unitId: "u3", tag: "ç¬¬ä¸ƒè¯¾", q: "è°åœ¨å”±æ­Œï¼ˆ ï¼‰", options: ["ã€‚", "ï¼Œ", "ï¼Ÿ", "ï¼"], a: 2, r: "ç–‘é—®å¥ç”¨é—®å·ã€‚" },

    // --- å•å…ƒå›› (15é¢˜) ---
    { unitId: "u4", tag: "å•å…ƒå››", q: "æˆ‘å’Œå§å§ï¼ˆ  ï¼‰çˆ±çœ‹ä¹¦ã€‚", options: ["åˆ", "éƒ½", "å¾ˆ", "æ˜¯"], a: 1, r: "æˆ‘å’Œå§å§éƒ½çˆ±ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "é€‰å‡ºæ­£ç¡®çš„å¥å·ï¼šçˆ¸çˆ¸å›å®¶äº†ï¼ˆ ï¼‰", options: [",", "â—‹", "ã€‚", "?"], a: 2, r: "æ ‡å‡†å¥å·æ˜¯å®å¿ƒçš„åœˆã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "å“¥å“¥å€’äº†ä¸€æ¯ï¼ˆ  ï¼‰ç»™å¥¶å¥¶ã€‚", options: ["è‹¹æœ", "å¼€æ°´", "ä¹¦åŒ…", "ç¬”"], a: 1, r: "å¼€æ°´å¯ä»¥å€’åœ¨æ¯é‡Œã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "é€‰å‡ºâ€œå§å§â€çš„æ‹¼éŸ³ï¼š", options: ["jiÄ› jie", "jÄ› jÄ›", "qiÄ› qie", "jiÄ› jiÃ©"], a: 0, r: "å§å§çš„æ­£ç¡®æ‹¼éŸ³ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "æˆ‘çˆ±æˆ‘çš„ï¼ˆ  ï¼‰ã€‚", options: ["å®¶", "é—¨", "å»", "å­"], a: 0, r: "å®¶æ˜¯æœ€æ¸©æš–çš„åœ°æ–¹ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "é€‰å‡ºæ­£ç¡®çš„å­—ï¼šçˆ¸çˆ¸ï¼ˆ  ï¼‰ç­äº†ã€‚", options: ["ä¸Š", "ä¸‹", "ä¸­", "ä¸"], a: 1, r: "ä¸‹ç­å›å®¶ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "æˆ‘å¸®çˆ·çˆ·ï¼ˆ  ï¼‰é‹å­ã€‚", options: ["ç©¿", "æ‹¿", "èµ°", "çœ‹"], a: 0, r: "ç©¿é‹å­ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "çˆ¸çˆ¸ï¼ˆ  ï¼‰å¦ˆå¦ˆéƒ½å›å®¶äº†ã€‚", options: ["åƒ", "å’Œ", "ä¹Ÿ", "æŠŠ"], a: 1, r: "è¡¨ç¤ºä¸¤è€…å¹¶åˆ—ç”¨â€œå’Œâ€ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "æˆ‘çš„å®¶å¾ˆï¼ˆ  ï¼‰ã€‚", options: ["èƒ†å°", "æ¸©æš–", "äº®", "é•¿"], a: 1, r: "å½¢å®¹å®¶å¾ˆæ¸©é¦¨ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "é€‰å‡ºâ€œç”Ÿç—…â€çš„è¯»éŸ³ï¼š", options: ["shÄ“ng bÃ¬ng", "shÄ“n bÃ¬n", "sheng bin", "shÄ“ng bÃ¬n"], a: 0, r: "åé¼»éŸ³ shÄ“ng bÃ¬ngã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "ä½ æ”¾ä¸‹ä¹¦åŒ…ï¼ˆ ï¼‰æˆ‘ç»™ä½ è®²æ•…äº‹ã€‚", options: ["ï¼Œ", "ã€‚", "ï¼", "ï¼Ÿ"], a: 0, r: "è¯æ²¡è¯´å®Œç”¨é€—å·ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "æˆ‘èƒŒç€ï¼ˆ  ï¼‰ä¸Šå­¦æ ¡ã€‚", options: ["è¡£æœ", "ä¹¦åŒ…", "è€å¸ˆ", "è‹¹æœ"], a: 1, r: "èƒŒä¹¦åŒ…ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "é€‰å‡ºâ€œé—¨â€çš„å­—å½¢ï¼š", options: ["ä»¬", "é—®", "é—¨", "é—ª"], a: 2, r: "é—¨æ¡†çš„æ ·å­ã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "å§å§ï¼ˆ  ï¼‰èµ·ä¸€ä¸ªè‹¹æœç»™å¥¶å¥¶ã€‚", options: ["æ", "æ‹¿", "èƒŒ", "é€"], a: 1, r: "æ‹¿èµ·è‹¹æœã€‚" },
    { unitId: "u4", tag: "å•å…ƒå››", q: "æ”¾å­¦äº†ï¼ˆ ï¼‰æˆ‘ä»¬è¦å›å®¶ã€‚", options: ["ã€‚", "ï¼Œ", "ï¼Ÿ", "ï¼"], a: 1, r: "é€—å·è¡¨ç¤ºä¸­é¡¿ã€‚" },

    // --- å•å…ƒäº” (15é¢˜) ---
    { unitId: "u5", tag: "å•å…ƒäº”", q: "æœˆäº®åˆåœ†åˆï¼ˆ  ï¼‰ã€‚", options: ["é¦™", "ç”œ", "äº®", "ç™½"], a: 1, r: "æœˆäº®åˆåœ†åˆäº®ã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "å¤§æ ‘åƒä¸€æŠŠå¤§ï¼ˆ  ï¼‰ã€‚", options: ["é›ªçƒ", "é•œå­", "é›¨ä¼", "æœˆé¥¼"], a: 2, r: "å½¢çŠ¶åƒé›¨ä¼ã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "ä¸­ç§‹èŠ‚ï¼Œæˆ‘ä»¬è¦åƒï¼ˆ  ï¼‰ã€‚", options: ["æœˆé¥¼", "æ£‰èŠ±", "é¥¼å¹²", "è‹¹æœ"], a: 0, r: "ä¸­ç§‹ä¼ ç»Ÿã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "ç™½äº‘æ˜¯ï¼ˆ  ï¼‰è‰²çš„ã€‚", options: ["çº¢", "ç™½", "ç»¿", "é»‘"], a: 1, r: "ç™½äº‘ç™½ç™½ã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "é€‰å‡ºâ€œæœ‹å‹â€çš„æ‹¼éŸ³ï¼š", options: ["pÃ©ng you", "pÃ¨ng yÃ³u", "pÃ©n iou", "pÃ©n yÇ’u"], a: 0, r: "è½»å£° youã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "è¥¿ç“œåˆå¤§åˆï¼ˆ  ï¼‰ã€‚", options: ["åœ†", "äº®", "ç™½", "é«˜"], a: 0, r: "å½¢å®¹è¥¿ç“œã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "é€‰å‡ºâ€œä¹Ÿâ€å­—ï¼š", options: ["ä»–", "ä¹Ÿ", "åœ°", "å¥¹"], a: 1, r: "æˆ‘ä¹Ÿå¾ˆå¼€å¿ƒã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "ç™½äº‘ï¼ˆ  ï¼‰æ£‰èŠ±ã€‚", options: ["å’Œ", "åƒ", "éƒ½", "æŠŠ"], a: 1, r: "æ¯”å–»è¯â€œåƒâ€ã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "å¤§å®¶ä¸€åŒï¼ˆ  ï¼‰æ¸¸æˆã€‚", options: ["ç©", "åš", "çœ‹", "è¯´"], a: 0, r: "ç©æ¸¸æˆã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "æ™šä¸Šï¼Œæˆ‘æç€ï¼ˆ  ï¼‰å»å…¬å›­ã€‚", options: ["ä¹¦åŒ…", "èŠ±ç¯", "è¡£æœ", "æœˆé¥¼"], a: 1, r: "æèŠ±ç¯ã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "æœˆäº®åƒï¼ˆ  ï¼‰çš„é•œå­ã€‚", options: ["é—ªäº®", "æ¬¢å¿«", "èƒ†å°", "æ¸©æš–"], a: 0, r: "é—ªäº®çš„é•œå­ã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "é€‰å‡ºâ€œåœ†â€çš„æ‹¼éŸ³ï¼š", options: ["yuÃ¡n", "yÃ¡n", "yÃºn", "yuÇn"], a: 0, r: "åœ† yuÃ¡nã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "æˆ‘ä»¬æ˜¯ï¼ˆ  ï¼‰æœ‹å‹ã€‚", options: ["å°", "å¤§", "å¥½", "ç™½"], a: 2, r: "å¥½æœ‹å‹ã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "ä¸­ç§‹ï¼ˆ  ï¼‰çœŸçƒ­é—¹ã€‚", options: ["æ—¥", "æœˆ", "èŠ‚", "å¹´"], a: 2, r: "ä¸­ç§‹èŠ‚ã€‚" },
    { unitId: "u5", tag: "å•å…ƒäº”", q: "æœˆé¥¼åˆé¦™åˆï¼ˆ  ï¼‰ã€‚", options: ["ç”œ", "äº®", "åœ†", "ç™½"], a: 0, r: "åˆé¦™åˆç”œã€‚" },

    // --- å•å…ƒå…­ (14é¢˜ - å·²åˆ é™¤æŒ‡å®šé¢˜ç›®) ---
    { unitId: "u6", tag: "å•å…ƒå…­", q: "ä½ ï¼ˆ  ï¼‰ä»€ä¹ˆä¸å¼€å¿ƒï¼Ÿ", options: ["ä¸º", "è°", "æ ·", "æ€"], a: 0, r: "ä¸ºä»€ä¹ˆã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "é©¬è·¯æ²¡æœ‰æ‰‹ï¼Œä¹Ÿæ²¡æœ‰ï¼ˆ  ï¼‰ã€‚", options: ["ç¬”", "è„š", "å£", "ä¹¦"], a: 1, r: "é©¬è·¯æ²¡æœ‰è„šã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "é€‰å‡ºâ€œå›ç­”â€çš„æ‹¼éŸ³ï¼š", options: ["huÃ­ dÃ¡", "huÇ dÇ", "huÃ­ tÄ", "huÃ­ da"], a: 0, r: "å›ç­” huÃ­ dÃ¡ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "è¿‡é©¬è·¯è¦èµ°åœ¨ï¼ˆ  ï¼‰ä¸Šã€‚", options: ["è‰åŸ", "é©¬è·¯", "æ ¡å›­", "å…¬å›­"], a: 1, r: "èµ°åœ¨é©¬è·¯ä¸Šã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "ä»–èƒ†å­å°ï¼Œï¼ˆ  ï¼‰ä¸æ•¢è‡ªå·±èµ°ã€‚", options: ["æ€»æ˜¯", "åˆ°å¤„", "æ­£åœ¨", "å·²ç»"], a: 0, r: "æ€»æ˜¯è¡¨ç¤ºç»å¸¸ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "çˆ¸çˆ¸ï¼ˆ  ï¼‰è¯´ï¼šâ€œæˆ‘ä¸æ€•ã€‚â€", options: ["å¤§å¤§", "å°å°", "æ‚„æ‚„", "é«˜é«˜"], a: 2, r: "æ‚„æ‚„è¯´è¯ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "ä½ å«ä»€ä¹ˆåå­—ï¼ˆ ï¼‰", options: ["ã€‚", "ï¼Œ", "ï¼", "ï¼Ÿ"], a: 3, r: "é—®å¥ç”¨é—®å·ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "è¿‡é©¬è·¯ï¼ˆ  ï¼‰ä¸€ç›´å‘å‰èµ°ã€‚", options: ["å»", "åˆ°", "ä¸€", "æŠŠ"], a: 2, r: "ä¸€ç›´å‘å‰èµ°ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "é€‰å‡ºâ€œè¯´â€çš„åæ—ï¼š", options: ["è® ", "æ°µ", "å£", "æ‰Œ"], a: 0, r: "è¨€å­—æ—ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "ä»–ï¼ˆ  ï¼‰å¼€äº†æ‰‹ï¼Œè‡ªå·±èµ°ã€‚", options: ["æŠ“", "æ‹¿", "æ”¾", "æ‹‰"], a: 2, r: "æ”¾å¼€æ‰‹ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "é€‰å‡ºâ€œèƒ†å°â€çš„åä¹‰è¯ï¼š", options: ["å¿«ä¹", "èƒ†å¤§", "å¼€å¿ƒ", "æ¸©æš–"], a: 1, r: "èƒ†å°å¯¹èƒ†å¤§ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "ï¼ˆ  ï¼‰æ¬¡è¿‡é©¬è·¯ï¼Œæˆ‘éƒ½å¾ˆå°å¿ƒã€‚", options: ["ä¸€", "æ¯", "è¿™", "å“ª"], a: 1, r: "æ¯æ¬¡éƒ½ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "è¿™æœ¬ä¹¦æ˜¯è°çš„ï¼ˆ ï¼‰", options: ["ã€‚", "ï¼Œ", "ï¼Ÿ", "ï¼"], a: 2, r: "é—®å·ã€‚" },
    { unitId: "u6", tag: "å•å…ƒå…­", q: "çˆ¸çˆ¸æ˜¯ä¸ªï¼ˆ  ï¼‰é¬¼ã€‚", options: ["å¼€å¿ƒ", "èƒ†å°", "å¿«ä¹", "ç¾ä¸½"], a: 1, r: "èƒ†å°é¬¼ã€‚" },

    // --- å•å…ƒä¸ƒ (15é¢˜) ---
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "æˆ‘ï¼ˆ  ï¼‰ç¥ç¦é€ç»™ä½ ã€‚", options: ["å’Œ", "æŠŠ", "åƒ", "ç»™"], a: 1, r: "æŠŠå­—å¥ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "ï¼ˆ  ï¼‰çš„åœ£è¯å¡ã€‚", options: ["æ¬¢å¿«", "ç¾ä¸½", "èƒ†å°", "æ¸©æš–"], a: 1, r: "ç¾ä¸½çš„å¡ç‰‡ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "å“‡ï¼Œè¿™é‡ŒçœŸç¾å•Šï¼ˆ ï¼‰", options: ["ã€‚", "ï¼", "ï¼Ÿ", "ï¼Œ"], a: 1, r: "æ„Ÿå¹å¥ç”¨å¹å·ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "æˆ‘è¦æŠŠå¡ç‰‡é€ï¼ˆ  ï¼‰è°å‘¢ï¼Ÿ", options: ["ç»™", "åˆ°", "å›", "å»"], a: 0, r: "é€ç»™ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "é€‰å‡ºâ€œå¿«ä¹â€çš„è¯»éŸ³ï¼š", options: ["kuÃ i lÃ¨", "kuÃ i luÃ²", "guÃ i lÃ¨", "kuÃ i lÃ©"], a: 0, r: "å¿«ä¹ lÃ¨ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "æˆ‘ç”¨ï¼ˆ  ï¼‰ç”»å°é¸Ÿã€‚", options: ["ç¬”", "æ‰‹", "ä¹¦", "çº¸"], a: 0, r: "ç”¨ç¬”ç”»ç”»ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "åœ£è¯è€äººæ¥åˆ°äº†ï¼ˆ ï¼‰", options: ["ï¼", "ï¼Ÿ", "ï¼Œ", "ã€‚"], a: 0, r: "å¹å·è¡¨ç¤ºå…´å¥‹ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "é€‰å‡ºâ€œæˆé•¿â€çš„æ‹¼éŸ³ï¼š", options: ["chÃ©ng zhÇng", "chÃ©n zÄƒng", "chÃ©ng chÃ¡ng", "chÃ©n chÇng"], a: 0, r: "æˆé•¿ zhÇngã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "å¹³å®‰å¤œï¼Œæˆ‘å‘ï¼ˆ  ï¼‰è®¸æ„¿ã€‚", options: ["è¡Œäºº", "æ˜Ÿæ˜Ÿ", "å½©ç¬”", "æ¡Œå­"], a: 1, r: "å‘æ˜Ÿæ˜Ÿè®¸æ„¿ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "æ ¡å›­é‡Œå……æ»¡äº†ï¼ˆ  ï¼‰çš„ç¬‘å£°ã€‚", options: ["æ¬¢å¿«", "èƒ†å°", "æ¸©æš–", "é—ªäº®"], a: 0, r: "æ¬¢å¿«çš„ç¬‘å£°ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "æˆ‘ï¼ˆ  ï¼‰å¯ä»¥è‡ªå·±åšå¡ç‰‡ã€‚", options: ["è¦", "ä¼š", "é€", "å¬"], a: 1, r: "ä¼šè¡¨ç¤ºèƒ½åŠ›ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "é€‰å‡ºâ€œæ˜Ÿæ˜Ÿâ€çš„å­—å½¢ï¼š", options: ["é’", "æ˜Ÿ", "æ™´", "å…´"], a: 1, r: "è¾¨å­—ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "çª—å¤–ä¼ æ¥å¥½å¬çš„åœ£è¯ï¼ˆ  ï¼‰ã€‚", options: ["è¯", "æ­Œ", "ç¬”", "ç”»"], a: 1, r: "å¥½å¬çš„æ­Œã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "å¦ˆå¦ˆï¼ˆ  ï¼‰è‹¹æœæ”¾åœ¨æ¡Œå­ä¸Šã€‚", options: ["å’Œ", "éƒ½", "æŠŠ", "åƒ"], a: 2, r: "æŠŠè‹¹æœæ”¾å¥½ã€‚" },
    { unitId: "u7", tag: "å•å…ƒä¸ƒ", q: "ç¥ä½ ç”Ÿæ—¥ï¼ˆ  ï¼‰ã€‚", options: ["å¼€å¿ƒ", "å¿«ä¹", "æ¸©æš–", "ç¾ä¸½"], a: 1, r: "ç”Ÿæ—¥å¿«ä¹ã€‚" }
  ];

  // è¿‡æ»¤å½“å‰å•å…ƒçš„é¢˜ç›®
  const activeQuiz = allQuizData.filter(q => q.unitId === selectedUnit);

  const handleStartQuiz = (unitId) => {
    setSelectedUnit(unitId);
    setView('quiz');
    setCurrentQuestionIdx(0);
    setScore(0);
    setShowResult(false);
    setSelectedOption(null);
    setIsCorrect(null);
    setShowHint(false);
  };

  const handleOptionClick = (index) => {
    if (selectedOption !== null) return;
    setSelectedOption(index);
    const correct = index === activeQuiz[currentQuestionIdx].a;
    setIsCorrect(correct);
    if (correct) setScore(score + 1);
  };

  const handleNext = () => {
    if (currentQuestionIdx < activeQuiz.length - 1) {
      setCurrentQuestionIdx(currentQuestionIdx + 1);
      setSelectedOption(null);
      setIsCorrect(null);
      setShowHint(false);
    } else {
      setShowResult(true);
    }
  };

  const goHome = () => {
    setView('home');
    setSelectedUnit(null);
  };

  // --- ä¸»é¡µé¢è§†å›¾ ---
  if (view === 'home') {
    return (
      <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white flex flex-col items-center p-6">
        <div className="w-full max-w-4xl mt-12">
          <header className="text-center mb-16">
            <h1 className="text-5xl font-black text-blue-600 mb-4 flex items-center justify-center gap-4">
              <Gamepad2 size={56} className="text-orange-400" />
              åæ–‡å…¨çœŸæ¨¡æ‹Ÿæœº
            </h1>
            <p className="text-2xl text-blue-400 font-medium">å°æœ‹å‹ï¼Œå…ˆé€‰ä¸€è¯¾å¼€å§‹å­¦ä¹ å§ï¼</p>
          </header>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {units.map((unit) => (
              <button
                key={unit.id}
                onClick={() => handleStartQuiz(unit.id)}
                className="group relative bg-white rounded-[32px] p-10 shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 text-left overflow-hidden border-b-8 border-gray-100"
              >
                <div className={`absolute top-0 right-0 w-28 h-28 ${unit.color} opacity-10 rounded-bl-full group-hover:scale-125 transition-transform`}></div>
                <div className="text-5xl mb-6">{unit.icon}</div>
                <h3 className="text-2xl font-black text-gray-800 mb-2">{unit.title}</h3>
                <p className="text-gray-500 font-bold text-lg">{unit.subtitle}</p>
                <div className="mt-8 flex items-center text-blue-500 font-black group-hover:translate-x-2 transition-transform">
                  å¼€å§‹ç»ƒä¹  <ArrowRight size={22} className="ml-2" />
                </div>
              </button>
            ))}
          </div>
        </div>
        
        <div className="mt-auto py-12 flex gap-6">
            {[1,2,3].map(i => <Heart key={i} size={32} fill="#F87171" className="text-red-400 animate-bounce" style={{animationDelay: `${i*0.2}s`}} />)}
        </div>
      </div>
    );
  }

  // --- ç»“æœé¡µé¢è§†å›¾ ---
  if (showResult) {
    return (
      <div className="min-h-screen bg-pink-50 flex flex-col items-center justify-center p-6">
        <div className="bg-white rounded-[48px] shadow-2xl p-12 max-w-md w-full border-b-[12px] border-pink-100 text-center">
          <Trophy className="w-28 h-28 text-yellow-400 mx-auto mb-8 drop-shadow-xl animate-pulse" />
          <h2 className="text-4xl font-black text-gray-800 mb-2">ç»ƒä¹ å®Œæˆï¼</h2>
          <p className="text-pink-500 text-xl font-bold mb-10">
            {units.find(u => u.id === selectedUnit)?.title}
          </p>
          
          <div className="bg-gradient-to-br from-pink-50 to-white rounded-[32px] py-10 mb-10 border-2 border-pink-100">
            <p className="text-gray-500 mb-2 font-bold text-lg">æœ€ç»ˆå¾—åˆ†</p>
            <div className="text-7xl font-black text-pink-500">{score} <span className="text-3xl text-pink-300">/ {activeQuiz.length}</span></div>
          </div>

          <div className="space-y-6">
            <button 
              onClick={() => handleStartQuiz(selectedUnit)}
              className="w-full bg-orange-400 hover:bg-orange-500 text-white font-black py-5 rounded-[24px] shadow-lg transition-all flex items-center justify-center gap-3 text-xl"
            >
              <RefreshCcw size={24} /> å†è¯•ä¸€æ¬¡
            </button>
            <button 
              onClick={goHome}
              className="w-full bg-white border-4 border-gray-100 hover:bg-gray-50 text-gray-400 font-black py-5 rounded-[24px] transition-all flex items-center justify-center gap-3 text-xl"
            >
              <Home size={24} /> æ¢ä¸ªå•å…ƒ
            </button>
          </div>
        </div>
      </div>
    );
  }

  // --- ç»ƒä¹ é¢˜ç›®è§†å›¾ ---
  const currentData = activeQuiz[currentQuestionIdx];
  const progress = ((currentQuestionIdx + 1) / activeQuiz.length) * 100;

  return (
    <div className="min-h-screen bg-blue-50 p-6 md:p-12 flex flex-col items-center">
      {/* é¡¶éƒ¨çŠ¶æ€æ  */}
      <div className="w-full max-w-2xl flex items-center justify-between mb-8">
        <button 
          onClick={goHome}
          className="p-4 bg-white rounded-2xl shadow-md text-gray-400 hover:text-blue-500 transition-all transform hover:scale-105 active:scale-95"
        >
          <ChevronLeft size={28} />
        </button>
        <div className="bg-white px-8 py-4 rounded-3xl shadow-md flex items-center gap-6 border-b-4 border-blue-100">
          <span className="font-black text-blue-600 flex items-center gap-2 text-lg">
            <Book size={20} /> {currentData.tag}
          </span>
          <div className="w-px h-6 bg-gray-200"></div>
          <span className="font-black text-yellow-500 flex items-center gap-2 text-lg">
            <Star size={20} fill="currentColor" /> {score}
          </span>
        </div>
        <div className="text-gray-400 font-black text-lg">
          {currentQuestionIdx + 1} / {activeQuiz.length}
        </div>
      </div>

      {/* è¿›åº¦æ¡ */}
      <div className="w-full max-w-2xl h-5 bg-white rounded-full mb-10 overflow-hidden p-1 shadow-inner">
        <div 
          className="h-full bg-gradient-to-r from-blue-400 to-indigo-400 rounded-full transition-all duration-700 ease-out"
          style={{ width: `${progress}%` }}
        />
      </div>

      {/* é¢˜ç›®æ ¸å¿ƒå¡ç‰‡ */}
      <div className="w-full max-w-2xl bg-white rounded-[48px] shadow-2xl p-10 md:p-14 mb-10 border-b-[12px] border-blue-100 relative">
        <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-blue-500 text-white px-6 py-2 rounded-full font-black text-sm tracking-widest uppercase">
          Question
        </div>
        
        <h2 className="text-3xl md:text-4xl font-black text-gray-800 mb-12 leading-relaxed text-center">
          {currentData.q}
        </h2>

        <div className="grid grid-cols-1 gap-5">
          {currentData.options.map((option, idx) => (
            <button
              key={idx}
              onClick={() => handleOptionClick(idx)}
              className={`
                group p-7 rounded-[28px] text-left text-2xl font-black transition-all duration-300 border-4 relative overflow-hidden
                ${selectedOption === null 
                  ? "border-gray-50 bg-gray-50 hover:border-blue-300 hover:bg-blue-50 text-gray-700" 
                  : idx === currentData.a
                    ? "border-green-400 bg-green-50 text-green-700"
                    : selectedOption === idx
                      ? "border-red-400 bg-red-50 text-red-700"
                      : "border-gray-50 bg-gray-50 opacity-40"
                }
              `}
            >
              <div className="flex items-center justify-between relative z-10">
                <span className="flex items-center gap-4">
                  <span className={`w-10 h-10 rounded-xl flex items-center justify-center text-sm ${selectedOption === idx ? 'bg-white shadow-sm' : 'bg-white/50'}`}>
                    {String.fromCharCode(65 + idx)}
                  </span>
                  {option}
                </span>
                {selectedOption !== null && idx === currentData.a && <CheckCircle size={32} className="text-green-500 animate-bounce" />}
                {selectedOption === idx && idx !== currentData.a && <AlertCircle size={32} className="text-red-500" />}
              </div>
            </button>
          ))}
        </div>

        {/* ç­”æ¡ˆè§£æåŒº */}
        {selectedOption !== null && (
          <div className={`mt-10 p-8 rounded-[32px] animate-in fade-in zoom-in-95 duration-500 ${isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
            <div className="flex items-center gap-3 font-black text-xl mb-2">
              {isCorrect ? "âœ¨ å›ç­”æ­£ç¡®ï¼" : "ğŸ’ª åˆ«ç°å¿ƒï¼Œå†åŠªåŠ›ï¼"}
            </div>
            <p className="font-bold text-lg opacity-80">{currentData.r}</p>
          </div>
        )}
      </div>

      {/* åº•éƒ¨äº¤äº’åŒº */}
      <div className="w-full max-w-2xl flex justify-between items-center px-4">
        <button 
          onClick={() => setShowHint(!showHint)}
          className={`
            flex items-center gap-3 font-black text-lg bg-white px-8 py-5 rounded-[24px] shadow-lg transition-all border-b-4 
            ${showHint ? "border-yellow-200 text-yellow-600" : "border-blue-100 text-blue-500 hover:bg-blue-50"}
          `}
        >
          <Lightbulb size={28} className={showHint ? "fill-yellow-400 text-yellow-500" : ""} />
          {showHint ? currentData.hint : "å°è´´å£«"}
        </button>

        <button
          onClick={handleNext}
          disabled={selectedOption === null}
          className={`
            flex items-center gap-4 px-12 py-5 rounded-[24px] font-black text-2xl shadow-xl transition-all
            ${selectedOption === null 
              ? "bg-gray-200 text-gray-400 cursor-not-allowed translate-y-1" 
              : "bg-orange-400 hover:bg-orange-500 text-white transform hover:-translate-y-1 active:translate-y-0 border-b-8 border-orange-600"
            }
          `}
        >
          {currentQuestionIdx < activeQuiz.length - 1 ? "ä¸‹ä¸€é¢˜" : "å®Œæˆç»ƒä¹ "}
          <ArrowRight size={28} />
        </button>
      </div>
    </div>
  );
};

export default App;
